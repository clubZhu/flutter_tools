# 视频下载功能 - 快速测试指南

## ✅ 已修复的问题

1. **Android权限缺失** - 已添加所有必要权限
2. **下载路径问题** - 已修复为应用专用目录
3. **权限请求逻辑** - 已优化区分Android版本
4. **下载验证** - 添加了文件存在性检查

---

## 🚀 如何测试

### 方法1: 使用真实链接（推荐）

#### TikTok测试
1. 打开TikTok应用
2. 分享任意视频
3. 复制链接
4. 粘贴到应用的输入框
5. 点击"解析视频"
6. 等待解析完成后点击"下载"

#### 抖音测试
1. 打开抖音应用
2. 分享任意视频
3. 复制链接
4. 粘贴到应用的输入框
5. 点击"解析视频"
6. 等待解析完成后点击"下载"

### 方法2: 使用测试视频（无需解析）

直接在浏览器或应用中测试以下URL：

#### 测试视频1（小文件 ~1MB）
```
https://sample-videos.com/video321/mp4/720/big_buck_bunny_720p_1mb.mp4
```

#### 测试视频2（中等文件 ~10MB）
```
https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/720/Big_Buck_Bunny_720_10MB_5mb.mp4
```

---

## 📱 权限设置

### 首次使用时

1. **Android 13+**
   - 应用会请求"照片和视频"权限
   - 点击"允许"

2. **Android 12及以下**
   - 应用会请求"存储权限"
   - 点击"允许"

3. **iOS**
   - 应用会请求"照片"权限
   - 点击"允许访问所有照片"或"选定照片"

### 如果权限被拒绝

**Android**:
```
设置 > 应用 > Calculator App > 权限
```
启用以下权限：
- ✅ 存储（或文件和媒体）
- ✅ 照片和视频（Android 13+）

**iOS**:
```
设置 > Calculator App > 照片
```
选择：
- "所有照片" 或 "选定照片"

---

## 💾 查找下载的视频

### Android设备

#### 方法1: 使用文件管理器
1. 打开"文件管理器"或"我的文件"
2. 导航到：
   ```
   Android/data/com.example.untitled1/files/Movies/
   ```
3. 查看已下载的视频

#### 方法2: 使用相册应用
1. 打开"图库"或"相册"
2. 查看"视频"或"相册"标签
3. 可能需要刷新或重启相册应用

### iOS设备

```
应用文件 > Calculator App > Videos
```

或在文件应用中：
```
我的 iPhone > Calculator App > Videos
```

---

## 🐛 故障排查

### 问题：点击"下载"没反应

**解决步骤**:
1. ✅ 检查是否授予了存储权限
2. ✅ 查看视频是否解析成功
3. ✅ 查看控制台日志（使用`flutter run`）
4. ✅ 确认视频URL不为空

### 问题：下载进度卡在0%

**可能原因**:
- 网络连接问题
- 视频服务器响应慢
- URL已过期

**解决方法**:
1. 切换到更稳定的网络（WiFi）
2. 重新解析视频获取新链接
3. 刷新页面重试

### 问题：显示"下载失败"

**排查步骤**:
1. 检查设备存储空间是否充足
2. 确认应用有存储权限
3. 查看详细错误信息（控制台日志）
4. 尝试使用测试视频验证功能

### 问题：找不到下载的视频

**解决方法**:
1. 确认下载成功（看到成功提示）
2. 刷新文件管理器或相册
3. 重启设备后查看
4. 使用搜索功能搜索文件名

---

## 📊 测试清单

下载功能正常的标志：

- [ ] 应用正常启动
- [ ] 可以进入视频下载页面
- [ ] 粘贴链接后可以解析
- [ ] 解析后显示视频信息
- [ ] 视频可以预览播放
- [ ] 点击下载后请求权限
- [ ] 权限授予后开始下载
- [ ] 显示下载进度
- [ ] 下载完成后显示成功
- [ ] 可以在文件管理器找到视频
- [ ] 视频可以正常播放

---

## 🔧 开发者调试

### 查看日志
```bash
flutter run -v
```

查找关键日志：
```
开始下载: [URL]
保存到: [路径]
下载完成，文件大小: XX MB
```

### 清除缓存重试
```bash
flutter clean
flutter pub get
flutter run
```

### 卸载重装
```bash
# 完全卸载应用
adb uninstall com.example.untitled1

# 重新安装
flutter run
```

---

## ✨ 成功标志

当你看到以下提示时，说明下载成功：

```
✓ 视频已保存到: /storage/emulated/0/.../Movies/video_xxx.mp4
```

同时会在文件管理器的Movies文件夹中找到视频文件。

---

## 📞 支持

如果问题持续存在：

1. 检查设备Android版本（建议Android 10+）
2. 确保有足够的存储空间（至少100MB可用）
3. 使用稳定的网络连接
4. 尝试使用测试视频验证基本功能

---

**版本**: v1.1
**更新日期**: 2024-01-20
**状态**: ✅ 所有问题已修复
